#!/bin/bash
# ะขะตัั ะบััะธัะพะฒะฐะฝะธั Google Sheets API

API_URL="https://chronosphere7777.pythonanywhere.com"
CATALOG_URL="$API_URL/api/shop/1Dk0vQ3_K0t7Sqi50h85U_RYPdGwgXAG0xeYkzW5mvpc/catalog"

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ     ะขะะกะข ะะญะจะะะะะะะะฏ GOOGLE SHEETS                       โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ะัะพะฒะตััะตะผ ััะฐัะธััะธะบั ะบััะฐ ะฟะตัะตะด ัะตััะพะผ
echo "๐ ะกัะฐัะธััะธะบะฐ ะบััะฐ ะะ ัะตััะฐ:"
curl -s "$API_URL/api/debug/cache-stats" | python3 -m json.tool
echo ""
echo "================================================"
echo ""

# ะะตัะฒัะน ะทะฐะฟัะพั (ะดะพะปะถะตะฝ ะพะฑัะฐัะธัััั ะบ Google Sheets)
echo "๐ต ะะะะะะก #1 - ะะตัะฒัะน ะทะฐะฟัะพั (ะดะพะปะถะตะฝ ะธะดัะธ ะฒ Google Sheets)"
echo "   ะะฐะฟัะฐัะธะฒะฐั ะบะฐัะฐะปะพะณ ะผะฐะณะฐะทะธะฝะฐ..."
START1=$(date +%s.%N)
RESPONSE1=$(curl -s -w "\n%{http_code}\n%{time_total}" "$CATALOG_URL")
END1=$(date +%s.%N)
STATUS1=$(echo "$RESPONSE1" | tail -n 2 | head -n 1)
TIME1=$(echo "$RESPONSE1" | tail -n 1)

echo "   HTTP Status: $STATUS1"
echo "   ะัะตะผั ะพัะฒะตัะฐ: ${TIME1}s"
echo "   ะะฐะทะผะตั ะพัะฒะตัะฐ: $(echo "$RESPONSE1" | head -n -2 | wc -c) ะฑะฐะนั"
echo ""

# ะะตะฑะพะปััะฐั ะฟะฐัะทะฐ
sleep 1

# ะัะพัะพะน ะทะฐะฟัะพั (ะดะพะปะถะตะฝ ะฒะทััั ะธะท ะบััะฐ)
echo "๐ข ะะะะะะก #2 - ะะพะฒัะพัะฝัะน ะทะฐะฟัะพั (ะดะพะปะถะตะฝ ะฒะทััั ะธะท ะบััะฐ)"
echo "   ะะฐะฟัะฐัะธะฒะฐั ัะพั ะถะต ะบะฐัะฐะปะพะณ..."
START2=$(date +%s.%N)
RESPONSE2=$(curl -s -w "\n%{http_code}\n%{time_total}" "$CATALOG_URL")
END2=$(date +%s.%N)
STATUS2=$(echo "$RESPONSE2" | tail -n 2 | head -n 1)
TIME2=$(echo "$RESPONSE2" | tail -n 1)

echo "   HTTP Status: $STATUS2"
echo "   ะัะตะผั ะพัะฒะตัะฐ: ${TIME2}s"
echo "   ะะฐะทะผะตั ะพัะฒะตัะฐ: $(echo "$RESPONSE2" | head -n -2 | wc -c) ะฑะฐะนั"
echo ""

echo "================================================"
echo ""

# ะัะพะฒะตััะตะผ ััะฐัะธััะธะบั ะบััะฐ ะฟะพัะปะต ัะตััะฐ
echo "๐ ะกัะฐัะธััะธะบะฐ ะบััะฐ ะะะกะะ ัะตััะฐ:"
curl -s "$API_URL/api/debug/cache-stats" | python3 -m json.tool
echo ""

echo "================================================"
echo "ะะะะฃะะฌะขะะขะซ ะขะะกะขะ"
echo "================================================"
echo ""

# ะกัะฐะฒะฝะตะฝะธะต ะฒัะตะผะตะฝะธ
SPEEDUP=$(echo "scale=2; $TIME1 / $TIME2" | bc)

if (( $(echo "$TIME2 < $TIME1" | bc -l) )); then
    echo "โ ะะญะจะะะะะะะะ ะะะะะขะะะข!"
    echo "   ะะฐะฟัะพั #1 (Google Sheets): ${TIME1}s"
    echo "   ะะฐะฟัะพั #2 (ะบัั):           ${TIME2}s"
    echo "   ะฃัะบะพัะตะฝะธะต: ${SPEEDUP}x"
    echo ""
    echo "   ๐ ะัะพัะพะน ะทะฐะฟัะพั ะะ ะพะฑัะฐัะธะปัั ะบ Google Sheets!"
    echo "   ะะฐะฝะฝัะต ะฑัะปะธ ะฒะทััั ะธะท ัะตัะฒะตัะฝะพะณะพ ะบััะฐ."
else
    echo "โ๏ธ  ะัั ะผะพะถะตั ะฝะต ัะฐะฑะพัะฐัั"
    echo "   ะะฐะฟัะพั #1: ${TIME1}s"
    echo "   ะะฐะฟัะพั #2: ${TIME2}s"
    echo ""
    echo "   ะัะพะฒะตัััะต ะปะพะณะธ ัะตัะฒะตัะฐ ะธะปะธ cache-stats ะฒััะต."
fi

echo ""
echo "๐ก ะัั ะดะตะนััะฒะธัะตะปะตะฝ ะฒ ัะตัะตะฝะธะต 5 ะผะธะฝัั (300 ัะตะบัะฝะด)"
echo "   ะะพัะปะต ะธััะตัะตะฝะธั TTL ะฑัะดะตั ะฝะพะฒัะน ะทะฐะฟัะพั ะบ Google Sheets"
